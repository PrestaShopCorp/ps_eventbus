name: E2E Tests Results Slack Notification
description: Send slack notification
inputs:
  campaign:
    required: true
    type: string
  ps_version:
    required: true
    type: string
  passed:
    required: true
    type: string
  failed:
    required: true
    type: string
  skipped:
    required: true
    type: string
  total:
    required: true
    type: string
  run_id:
    required: true
    type: string
  slack_webhook_url:
    required: true
    type: string

runs:
  using: "composite"
  steps:
    - name: üì§ Send custom JSON data to Slack
      uses: slackapi/slack-github-action@v1.26.0
      with:
        payload: |
          {
            "blocks": [
              {
                "type": "section",
                "text": {
                  "type": "mrkdwn",
                  "text": "*üöÄ Eventbus E2E Tests Results*"
                }
              },
              {
                "type": "section",
                "fields": [
                  {
                    "type": "mrkdwn",
                    "text": "*üéè Campaign*\n${{ inputs.campaign }}"
                  },
                  {
                    "type": "mrkdwn",
                    "text": "*üêß PrestaShop Version*\n${{ inputs.ps_version }}"
                  },
                  {
                  "type": "mrkdwn",
                  "text": ":mag: *[Playwright Report](\${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ inputs.run_id }}#artifacts)*"
                  },
                  {
                  "type": "mrkdwn",
                  "text": ":rocket: *[GitHub Run](\${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ inputs.run_id }})*"
                  }
                ]
              },
              {
                "type": "section",
                "fields": [
                  {
                    "type": "mrkdwn",
                    "text": "*‚úÖ Passed:* ${{ inputs.passed }} / ${{ inputs.total }} tests"
                  },
                  {
                    "type": "mrkdwn",
                    "text": "*‚ùå Failed:* ${{ inputs.failed }} / ${{ inputs.total }} tests"
                  },
                  {
                    "type": "mrkdwn",
                    "text": "*üî∑ Skipped:* ${{ inputs.skipped }} / ${{ inputs.total }} tests"
                  }
                ]
              }
          }
      env:
        SLACK_WEBHOOK_URL: ${{ inputs.slack_webhook_url }}
        SLACK_WEBHOOK_TYPE: INCOMING_WEBHOOK
